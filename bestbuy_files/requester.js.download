$BV.Internal.define("requester",[window],["exports","jquery.core","parseUri"],function(f,m,e,c){var n=/^[^?#]*\.(js|djs)\?([^&#]*&)*format=(mobile)?(bulk)?embeddedhtml([&#].*)?$/i,o={},i=[],l=[],h={},d=new Date().getTime()%(1013<<20),g={},k;function b(p){return n.test(p);}function j(q,u,s){var p=c(q);var t=p.authority;if(f.location.host===t){return u(f);}var v=a(function(x){return x.location.host===t;});if(v){return u(v);}for(var r=0;r<i.length;r++){var w=i[r];if(w.targetDomain===t){return s(w);}}$BV.log("Cannot access url because no frame is available",q);}function a(p){if(p(f)){return f;}for(var q in o){var s=o[q];try{if(s.$BV&&p(s)){return s;}}catch(r){$BV.log("Cannot access frame: "+q,r);}}}e.extend(m,{getQueryParam:function(q){var p=new RegExp("[?&]"+q+"=([^&]+)","i").exec(f.location.search);return p&&decodeURIComponent(p[1]);},isUrlAllowed:function(q,p){var s=c(q).authority;for(var r=0;r<p.length;r++){if(m.domainMatches(p[r],s)){return true;}}return false;},domainMatches:function(s,t){if(s.charAt(0)==="."){var q=/^([^:]*)(:\d+)?$/.exec(t),r=q&&q[1];if(r){var p=("."+r).lastIndexOf(s);return p>=0&&p===(1+r.length-s.length);}}else{return t===s;}},get:function(p,r,s){if(b(p)){m.getJsonp(p,s);}else{try{f.frames[r].location=p;}catch(q){if(f.document.getElementById(r)){f.document.getElementById(r).contentWindow.location=p;}}}},getConfigKey:function(p){if(!p.requestConfigKey){h[p.requestConfigKey=String(++d)]=p;}return p.requestConfigKey;},getConfig:function(p){return typeof p==="object"?p:h[p];},getJsonp:function(r,t,p,s){var q=m.getConfig(t);if(!q){if(p){$BV.Internal.callAjax(r);}else{$BV.log("Cannot get url because no config is available",r,t);}}else{if(!m.isUrlAllowed(r,q.allowedDomains)){$BV.log("Cannot get url because hostname is not allowed",r);}else{if(e.isFunction(k)&&!s){k(r,q);}$BV.Internal.callAjax(r,q);}}},setStateChangeCallback:function(p){k=p;},findDocDomainFrame:a,isJsonpUrl:b,registerDocDomainFrame:function(p){var q=p.frameElement;o[q.name]=q.contentWindow;},registerCrossDomainProxy:function(p){i.push(p);},waitForCss:function(q,s){if(q.readyState==="complete"){s();return;}var p=q.href,r=l[p];if(!r){r=l[p]=$BV.Internal.newLatch(1);m.download(p,r.release);}r.queue(s);},download:function(p,q){j(p,function(r){r.$BV.Internal.require(["jquery.core"],function(s){s.ajax({type:"GET",url:p,complete:function(){q();}});});},function(r){r.download(p,q);});},post:function(p,q,r){j(p,function(s){s.$BV.Internal.require(["jquery.core"],function(t){t.post(p,q!=null?q:{},r,"json");});},function(s){s.post(c(p),q,r);});},postForm:function(r,t,u){var q=e(r),p=q.attr("action"),s=q.serializeArray();if(t){s.push({name:t,value:"true"});}m.post(p,s,u);},getFormURL:function(r){var q=e(r),p=q.attr("action"),s=q.serialize();return p+"?"+s;},jsLinkSelector:"a[data-bvjsref]",jsButtonLinkSelector:"button[data-bvjsref]",asJsLink:function(q){var p=q.attr("href");return{getUrl:function(){return q.attr("data-bvjsref");},setUrl:function(r){q.attr("data-bvjsref",r).attr("href",p);},unsetUrl:function(){q.removeAttr("data-bvjsref").removeAttr("href");},follow:function(r,s){m.getJsonp(this.getUrl(),q.attr("data-bvcfg"),r,s);},followIfNotDefaultPrevented:function(u){var t=u.timeStamp,r=this.getUrl(),s=q.attr("data-bvcfg");var v=g[t]=$BV.Internal.newLatch(1);v.queue(function(){m.getJsonp(r,s);});q.attr("href","javascript:$BV.Internal.Requester.followLink("+t+")").attr("target","_self");setTimeout(function(){q.attr("href",p).removeAttr("target");delete g[t];},1000);}};},followLink:function(p){if(g[p]){g[p].release();delete g[p];}else{$BV.log("Cannot follow link: "+p);}},asHtmLink:function(p){return{getUrl:function(){return p.attr("href");},setUrl:function(q){p.attr("href",q);},unsetUrl:function(){p.removeAttr("href");}};},asJsOrHtmLink:function(r){function p(){}var q=r.attr("data-bvjsref")?m.asJsLink(r):r.attr("href")?m.asHtmLink(r):{getUrl:p,unsetUrl:p};return{getUrl:function(){return q.getUrl();},setUrl:function(s){q.unsetUrl();q=b(s)?m.asJsLink(r):m.asHtmLink(r);q.setUrl(s);},unsetUrl:function(){q.unsetUrl();}};}});m.onPageLoad=function(v,t,p){if(v==="bindJsLinks"){p.undelegate(m.jsLinkSelector,"click.bvjsref").delegate(m.jsLinkSelector,"click.bvjsref",function(x){m.asJsLink(e(this)).followIfNotDefaultPrevented(x);});}else{if(v==="bindJsButtons"){p.undelegate(m.jsButtonLinkSelector,"click.bvjsref").delegate(m.jsButtonLinkSelector,"click.bvjsref",function(){m.asJsLink(e(this)).follow();});}else{if(v==="fillStaticLinks"){var s=/bvstate=pg:\d+\/ct:(r|q|s)&?/;var w=f.location.href.split("#");var r=w[0].replace(s,"");var u=r.slice(-1);if(u!="?"&&u!="&"){r=r+(r.indexOf("?")>-1?"&":"?");}var q=(w[1]&&w[1].length>0?"#"+w[1]:"");e("a[data-bvstate]").each(function(){var y=e(this).attr("data-bvstate");var x=/bvstate=pg:1\/ct:(r|q|s)/;if(x.test(y)){e(this).attr("href",r.slice(0,-1)+q);}else{e(this).attr("href",r+y+q);}e(this).removeAttr("data-bvstate");});}}}};$BV.Internal.Requester=m;});